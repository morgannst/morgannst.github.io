<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบบันทึกรายรับ-รายจ่าย (Pagination Demo)</title>
    
    <!-- SEO -->
    <meta name="description" content="ระบบบันทึกรายรับ - รายจ่าย" />
    <meta name="author" content="@SRNANIMALCARE" />
    <meta property="og:title" content="ระบบบันทึกรายรับ - รายจ่าย" />
    <meta property="og:description" content="จดบันทึกเพื่อกันลืม" />

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['"Noto Sans Thai"', 'sans-serif'] },
                    colors: { brand: { 500: '#0ea5e9', 600: '#0284c7' } }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Noto Sans Thai', sans-serif; -webkit-font-smoothing: antialiased; }
        .spinner {
            border: 3px solid rgba(255,255,255,0.3); border-radius: 50%; border-top: 3px solid #fff;
            width: 20px; height: 20px; animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .fade-in { animation: fadeIn 0.3s ease-out; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 h-screen overflow-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect, useContext, createContext } = React;

        // --- CONFIG ---
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxRNiK8lOstCv7kjCXEuEuAUaJgP3q_51g0_Q8i9iihj-SqyQkIIWO1Clw2xRh1kwxE/exec"; 

        // --- MOCK DATA GENERATOR (สำหรับทดสอบ Pagination) ---
        const generateMockData = () => {
            const data = [];
            const today = new Date();
            // สร้าง 50 รายการย้อนหลัง
            for (let i = 0; i < 50; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                const dateStr = date.toISOString().split('T')[0]; // YYYY-MM-DD
                
                data.push({
                    id: `mock_${i}`,
                    userId: 'morgan', // ให้ User Morgan เห็น
                    description: `รายการทดสอบที่ ${i + 1}`,
                    amount: Math.floor(Math.random() * 1000) + 50,
                    type: Math.random() > 0.5 ? 'expense' : 'income',
                    category: ['food', 'fuel', 'jan_snack', 'other'][Math.floor(Math.random() * 4)],
                    date: dateStr,
                    paymentMethod: Math.random() > 0.5 ? 'cash' : 'transfer',
                    timestamp: new Date().toLocaleString('th-TH')
                });
            }
            return data;
        };

        // --- CONSTANTS ---
        const KNOWN_USERS = [
            { id: 'morgan', name: 'ยิ่งยศ' },
            { id: 'ju', name: 'พี่จุ๊' },
            { id: 'yuyyuy', name: 'วรรณรวี' },
            { id: 'aunpun', name: 'บุปผาทิพย์' },
            { id: 'admin', name: 'ผู้ดูแลระบบ' },
        ];

        const CATEGORIES = [
            { id: 'mor', name: 'พี่หมอ', color: '#8b5cf6' },
            { id: 'ju', name: 'พี่จุ๊', color: '#ec4899' },
            { id: 'food', name: 'ค่ากับข้าว', color: '#f59e0b' },
            { id: 'fuel', name: 'เติมน้ำมัน', color: '#3b82f6' },
            { id: 'jan_snack', name: 'ค่าขนมแจน', color: '#10b981' },
            { id: 'other', name: 'อื่นๆ', color: '#64748b' },
        ];

        // --- ICONS ---
        const Icons = {
            Wallet: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path></svg>,
            User: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>,
            Lock: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>,
            ChevronLeft: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 19l-7-7 7-7"></path></svg>,
            ChevronRight: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5l7 7-7 7"></path></svg>,
            FilterX: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12"></path></svg>,
            Edit: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>,
            Trash: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>,
            Plus: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 4v16m8-8H4"></path></svg>,
            LogOut: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>,
            TrendingUp: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>,
            TrendingDown: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"></path></svg>,
            Transfer: () => <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path></svg>,
            Cash: () => <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>,
        };

        // --- HELPERS ---
        const formatCurrency = (amount) => new Intl.NumberFormat('th-TH', { style: 'currency', currency: 'THB' }).format(amount);
        
        const formatDate = (dateStr) => {
            if (!dateStr) return "";
            const [y, m, d] = dateStr.split('-').map(Number);
            const dateObj = new Date(y, m - 1, d);
            if (isNaN(dateObj.getTime())) return "";
            return `${dateObj.getDate()} ${dateObj.toLocaleDateString('th-TH', { month: 'short' })} ${dateObj.getFullYear() + 543}`;
        };

        const formatMonthYearTH = (isoMonthStr) => {
            if (!isoMonthStr) return "ทั้งหมด";
            const [year, month] = isoMonthStr.split('-');
            const date = new Date(parseInt(year), parseInt(month) - 1);
            return `${date.toLocaleDateString('th-TH', { month: 'long' })} ${parseInt(year) + 543}`;
        };

        const getTodayDateString = () => {
            const d = new Date();
            const year = d.getFullYear();
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        };

        // --- API ---
        const api = {
            login: async (username, password) => {
                try {
                    const res = await fetch(GOOGLE_SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'login', username, password }) });
                    return await res.json();
                } catch(e) { return null; }
            },
            fetchAll: async () => {
                try {
                    const res = await fetch(GOOGLE_SCRIPT_URL);
                    const data = await res.json();
                    // ถ้าข้อมูลน้อยกว่า 5 รายการ หรือ Error ให้ใช้ Mock Data เพื่อทดสอบ Pagination
                    if (!data || data.length < 5) return generateMockData();
                    return data;
                } catch (e) {
                    console.warn("API Error, using mock data");
                    return generateMockData(); 
                }
            },
            add: async (tx) => { await fetch(GOOGLE_SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'add', ...tx }) }); },
            edit: async (tx) => { await fetch(GOOGLE_SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'edit', ...tx }) }); },
            delete: async (id) => { await fetch(GOOGLE_SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'delete', id }) }); }
        };

        // --- COMPONENTS ---

        const TransactionTable = ({ transactions, user, onEdit, onDelete, filterMonth, setFilterMonth, limit, onViewAll }) => {
            const [currentPage, setCurrentPage] = useState(1);
            const itemsPerPage = 10; 

            // คำนวณข้อมูลที่จะแสดง
            let displayData = transactions;
            if (limit) {
                // โหมด Dashboard (แสดงจำกัดจำนวน)
                displayData = transactions.slice(0, limit);
            } else {
                // โหมดรายการทั้งหมด (มี Pagination)
                const startIndex = (currentPage - 1) * itemsPerPage;
                displayData = transactions.slice(startIndex, startIndex + itemsPerPage);
            }

            const totalPages = Math.ceil(transactions.length / itemsPerPage);

            // รีเซ็ตหน้าเมื่อมีการเปลี่ยนฟิลเตอร์
            useEffect(() => setCurrentPage(1), [filterMonth, transactions.length]);

            return (
                <div className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden flex flex-col h-full fade-in">
                    <div className="p-5 border-b border-slate-50 flex flex-col sm:flex-row justify-between items-center gap-3">
                        <div className="flex items-center gap-3 w-full sm:w-auto">
                            <h3 className="font-bold text-lg text-slate-700">{limit ? 'รายการล่าสุด' : 'รายการทั้งหมด'}</h3>
                            {limit && (
                                <button onClick={onViewAll} className="text-sm text-indigo-600 hover:underline flex items-center gap-1">
                                    ดูทั้งหมด <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5l7 7-7 7"></path></svg>
                                </button>
                            )}
                        </div>
                        
                        {!limit && (
                            <div className="flex items-center gap-2 bg-slate-50 px-3 py-1.5 rounded-lg border border-slate-200">
                                <span className="text-xs text-slate-500 font-medium">เดือน:</span>
                                <input type="month" value={filterMonth} onChange={(e) => setFilterMonth(e.target.value)}
                                    className="bg-transparent text-sm text-slate-700 focus:outline-none w-32" />
                                {filterMonth && (
                                    <button onClick={() => setFilterMonth('')} className="text-slate-400 hover:text-rose-500" title="ล้างตัวกรอง">
                                        <Icons.FilterX />
                                    </button>
                                )}
                            </div>
                        )}
                    </div>

                    <div className="overflow-x-auto flex-1">
                        <table className="w-full text-sm text-left">
                            <thead className="text-xs text-slate-500 uppercase bg-slate-50">
                                <tr>
                                    <th className="px-6 py-3">วันที่</th>
                                    <th className="px-6 py-3">รายการ</th>
                                    <th className="px-6 py-3">หมวดหมู่</th>
                                    <th className="px-6 py-3">ชำระ</th>
                                    {user.role === 'admin' && <th className="px-6 py-3">ผู้ใช้</th>}
                                    <th className="px-6 py-3 text-right">จำนวน</th>
                                    <th className="px-6 py-3 text-center">จัดการ</th>
                                </tr>
                            </thead>
                            <tbody>
                                {displayData.length === 0 ? (
                                    <tr><td colSpan="7" className="text-center py-10 text-slate-400">ไม่พบข้อมูล</td></tr>
                                ) : (
                                    displayData.map(t => (
                                        <tr key={t.id} className="border-b border-slate-50 hover:bg-slate-50 transition-colors">
                                            <td className="px-6 py-3 whitespace-nowrap text-slate-500">{formatDate(t.date)}</td>
                                            <td className="px-6 py-3 font-medium text-slate-700">{t.description}</td>
                                            <td className="px-6 py-3">
                                                <span className="px-2 py-1 rounded text-xs" style={{ backgroundColor: `${CATEGORIES.find(c=>c.id===t.category)?.color}20`, color: CATEGORIES.find(c=>c.id===t.category)?.color }}>
                                                    {CATEGORIES.find(c=>c.id===t.category)?.name || 'อื่นๆ'}
                                                </span>
                                            </td>
                                            <td className="px-6 py-3 text-xs text-slate-500">
                                                {t.paymentMethod === 'transfer' ? <span className="flex items-center gap-1"><Icons.Transfer/> โอน</span> : <span className="flex items-center gap-1"><Icons.Cash/> เงินสด</span>}
                                            </td>
                                            {user.role === 'admin' && <td className="px-6 py-3 text-xs text-slate-500">{KNOWN_USERS.find(u => u.id === t.userId)?.name || t.userId}</td>}
                                            <td className={`px-6 py-3 text-right font-bold ${t.type === 'income' ? 'text-emerald-600' : 'text-slate-700'}`}>
                                                {t.type === 'income' ? '+' : '-'} {formatCurrency(t.amount)}
                                            </td>
                                            <td className="px-6 py-3 text-center">
                                                <div className="flex justify-center gap-3">
                                                    <button onClick={() => onEdit(t)} className="text-slate-400 hover:text-indigo-600"><Icons.Edit /></button>
                                                    <button onClick={() => onDelete(t.id)} className="text-slate-400 hover:text-rose-500"><Icons.Trash /></button>
                                                </div>
                                            </td>
                                        </tr>
                                    ))
                                )}
                            </tbody>
                        </table>
                    </div>

                    {/* Pagination Controls */}
                    {!limit && transactions.length > 0 && (
                        <div className="p-4 border-t border-slate-100 flex justify-between items-center bg-slate-50">
                            <span className="text-xs text-slate-500">
                                แสดง {Math.min((currentPage - 1) * itemsPerPage + 1, transactions.length)} - {Math.min(currentPage * itemsPerPage, transactions.length)} จาก {transactions.length}
                            </span>
                            <div className="flex gap-2">
                                <button onClick={() => setCurrentPage(p => Math.max(1, p - 1))} disabled={currentPage === 1}
                                    className="p-2 rounded bg-white border text-slate-500 hover:text-indigo-600 hover:border-indigo-300 disabled:opacity-50 disabled:hover:border-slate-200">
                                    <Icons.ChevronLeft />
                                </button>
                                <span className="px-3 py-1 bg-white border rounded text-sm flex items-center">{currentPage} / {totalPages}</span>
                                <button onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))} disabled={currentPage === totalPages}
                                    className="p-2 rounded bg-white border text-slate-500 hover:text-indigo-600 hover:border-indigo-300 disabled:opacity-50 disabled:hover:border-slate-200">
                                    <Icons.ChevronRight />
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const Dashboard = ({ user, onLogout }) => {
            const [transactions, setTransactions] = useState([]);
            const [view, setView] = useState('dashboard');
            const [filterMonth, setFilterMonth] = useState(new Date().toISOString().slice(0, 7));
            const [modalConfig, setModalConfig] = useState({ isOpen: false, type: 'add', data: null });
            
            // Initial Load
            useEffect(() => {
                const load = async () => {
                    const data = await api.fetchAll();
                    setTransactions(data);
                };
                load();
            }, []);

            // Filter & Sort
            const visibleTransactions = useMemo(() => {
                let data = transactions;
                if (user.role !== 'admin') data = data.filter(t => t.userId === user.id);
                if (filterMonth) data = data.filter(t => t.date.startsWith(filterMonth));
                
                // Sort by Date DESC, then by ID DESC (Stable Sort)
                return data.sort((a, b) => {
                    const dateDiff = new Date(b.date) - new Date(a.date);
                    return dateDiff !== 0 ? dateDiff : String(b.id).localeCompare(String(a.id));
                });
            }, [transactions, user, filterMonth]);

            const stats = useMemo(() => {
                const income = visibleTransactions.filter(t => t.type === 'income').reduce((a, c) => a + c.amount, 0);
                const expense = visibleTransactions.filter(t => t.type === 'expense').reduce((a, c) => a + c.amount, 0);
                return { income, expense, balance: income - expense };
            }, [visibleTransactions]);

            const handleSave = async (data) => {
                if (modalConfig.type === 'add') {
                    await api.add(data);
                    // Optimistic UI: Add locally immediately
                    setTransactions(prev => [...prev, { ...data, id: Date.now(), userId: user.id }]);
                } else {
                    await api.edit(data);
                    // Optimistic UI: Update locally
                    setTransactions(prev => prev.map(t => t.id === data.id ? { ...t, ...data } : t));
                }
                setModalConfig({ ...modalConfig, isOpen: false });
                // Re-fetch in background to be sure
                api.fetchAll().then(setTransactions);
            };

            const handleDelete = async (id) => {
                if(!confirm("ยืนยันการลบ?")) return;
                setTransactions(prev => prev.filter(t => t.id !== id)); // Optimistic delete
                await api.delete(id);
            };

            return (
                <div className={`flex h-screen flex-col ${user.role === 'admin' ? 'bg-slate-100' : 'bg-slate-50'}`}>
                    <header className={`${user.role === 'admin' ? 'bg-slate-900' : 'bg-indigo-600'} text-white shadow-md p-4`}>
                        <div className="max-w-6xl mx-auto flex justify-between items-center">
                            <div className="flex items-center gap-2 cursor-pointer" onClick={() => setView('dashboard')}>
                                <Icons.Wallet /> <h1 className="font-bold text-lg hidden sm:block">ระบบการเงิน</h1>
                            </div>
                            <div className="flex items-center gap-4 text-sm">
                                <span>{user.name}</span>
                                <button onClick={onLogout} className="opacity-80 hover:opacity-100 flex gap-1"><Icons.LogOut /> ออก</button>
                            </div>
                        </div>
                    </header>

                    <main className="flex-1 overflow-y-auto p-4 max-w-6xl w-full mx-auto">
                        {view === 'dashboard' ? (
                            <div className="space-y-6 fade-in">
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div className="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                                        <div className="text-slate-400 text-sm">คงเหลือสุทธิ</div>
                                        <div className="text-3xl font-bold text-slate-800">{formatCurrency(stats.balance)}</div>
                                    </div>
                                    <div className="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 text-emerald-600">
                                        <div className="flex items-center gap-2"><Icons.TrendingUp /> รายรับ</div>
                                        <div className="text-2xl font-bold">+{formatCurrency(stats.income)}</div>
                                    </div>
                                    <div className="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 text-rose-600">
                                        <div className="flex items-center gap-2"><Icons.TrendingDown /> รายจ่าย</div>
                                        <div className="text-2xl font-bold">-{formatCurrency(stats.expense)}</div>
                                    </div>
                                </div>
                                <TransactionTable 
                                    transactions={visibleTransactions} 
                                    user={user} 
                                    onEdit={(t) => setModalConfig({ isOpen: true, type: 'edit', data: t })}
                                    onDelete={handleDelete}
                                    filterMonth={filterMonth}
                                    setFilterMonth={setFilterMonth}
                                    limit={10} 
                                    onViewAll={() => setView('list')}
                                />
                            </div>
                        ) : (
                            <TransactionTable 
                                transactions={visibleTransactions} 
                                user={user} 
                                onEdit={(t) => setModalConfig({ isOpen: true, type: 'edit', data: t })}
                                onDelete={handleDelete}
                                filterMonth={filterMonth}
                                setFilterMonth={setFilterMonth}
                            />
                        )}
                        <div className="h-20"></div>
                    </main>

                    <button onClick={() => setModalConfig({ isOpen: true, type: 'add', data: null })} 
                        className="fixed bottom-6 right-6 w-14 h-14 bg-indigo-600 text-white rounded-full shadow-lg flex items-center justify-center hover:scale-110 transition-transform z-50">
                        <Icons.Plus />
                    </button>

                    {modalConfig.isOpen && (
                        <TransactionModal 
                            isOpen={modalConfig.isOpen} 
                            type={modalConfig.type}
                            data={modalConfig.data}
                            onClose={() => setModalConfig({ ...modalConfig, isOpen: false })} 
                            onSave={handleSave} 
                        />
                    )}
                </div>
            );
        };

        const TransactionModal = ({ isOpen, type, data, onClose, onSave }) => {
            const [formData, setFormData] = useState({
                description: '', amount: '', type: 'expense', category: 'food', date: getTodayDateString(), paymentMethod: 'cash'
            });

            useEffect(() => {
                if (type === 'edit' && data) setFormData(data);
            }, [type, data]);

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 fade-in">
                    <div className="bg-white rounded-2xl w-full max-w-md p-6 shadow-xl slide-up">
                        <div className="flex justify-between mb-4">
                            <h3 className="font-bold text-lg">{type === 'add' ? 'เพิ่มรายการ' : 'แก้ไขรายการ'}</h3>
                            <button onClick={onClose}><Icons.X /></button>
                        </div>
                        <form onSubmit={(e) => { e.preventDefault(); onSave(formData); }}>
                            <div className="flex gap-2 bg-slate-100 p-1 rounded-lg mb-4">
                                {['income', 'expense'].map(t => (
                                    <button type="button" key={t} onClick={() => setFormData({...formData, type: t})} 
                                        className={`flex-1 py-2 rounded-md text-sm ${formData.type === t ? 'bg-white shadow text-indigo-600 font-bold' : 'text-slate-500'}`}>
                                        {t === 'income' ? 'รายรับ' : 'รายจ่าย'}
                                    </button>
                                ))}
                            </div>
                            <input required type="text" placeholder="รายละเอียด" className="w-full border p-2.5 rounded-lg mb-3" 
                                value={formData.description} onChange={e => setFormData({...formData, description: e.target.value})} />
                            <div className="flex gap-3 mb-3">
                                <input required type="number" placeholder="จำนวนเงิน" className="w-full border p-2.5 rounded-lg" 
                                    value={formData.amount} onChange={e => setFormData({...formData, amount: e.target.value})} />
                                <input required type="date" className="w-full border p-2.5 rounded-lg" 
                                    value={formData.date} onChange={e => setFormData({...formData, date: e.target.value})} />
                            </div>
                            <select className="w-full border p-2.5 rounded-lg mb-3 bg-white" value={formData.category} onChange={e => setFormData({...formData, category: e.target.value})}>
                                {CATEGORIES.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}
                            </select>
                            <div className="flex gap-4 mb-6">
                                {['cash', 'transfer'].map(m => (
                                    <label key={m} className={`flex-1 border p-2 rounded-lg flex justify-center items-center gap-2 cursor-pointer ${formData.paymentMethod === m ? 'border-indigo-500 bg-indigo-50 text-indigo-700' : ''}`}>
                                        <input type="radio" className="hidden" checked={formData.paymentMethod === m} onChange={() => setFormData({...formData, paymentMethod: m})} />
                                        {m === 'cash' ? <Icons.Cash/> : <Icons.Transfer/>} {m === 'cash' ? 'เงินสด' : 'โอน'}
                                    </label>
                                ))}
                            </div>
                            <button className="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold hover:bg-indigo-700">บันทึก</button>
                        </form>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [user, setUser] = useState(null);
            return (
                <div className="font-sans antialiased text-slate-900 bg-slate-50 min-h-screen">
                    {user ? <Dashboard user={user} onLogout={() => setUser(null)} /> : <LoginScreen onLogin={setUser} />}
                </div>
            );
        };

        const LoginScreen = ({ onLogin }) => {
            const [form, setForm] = useState({ username: '', password: '' });
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                const res = await api.login(form.username, form.password);
                setLoading(false);
                if (res && res.status === 'success') onLogin(res.user);
                else setError('เข้าสู่ระบบไม่สำเร็จ');
            };

            return (
                <div className="min-h-screen flex items-center justify-center bg-slate-100 p-4">
                    <div className="bg-white p-8 rounded-2xl shadow-xl w-full max-w-sm slide-up">
                        <div className="text-center mb-6">
                            <div className="bg-indigo-600 w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-4 text-white"><Icons.Wallet /></div>
                            <h1 className="text-2xl font-bold">เข้าสู่ระบบ</h1>
                        </div>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <input type="text" placeholder="ชื่อผู้ใช้" className="w-full border p-3 rounded-lg" required 
                                value={form.username} onChange={e => setForm({...form, username: e.target.value})} />
                            <input type="password" placeholder="รหัสผ่าน" className="w-full border p-3 rounded-lg" required 
                                value={form.password} onChange={e => setForm({...form, password: e.target.value})} />
                            {error && <div className="text-red-500 text-sm text-center">{error}</div>}
                            <button disabled={loading} className="w-full bg-indigo-600 text-white py-3 rounded-lg font-bold hover:bg-indigo-700 disabled:opacity-50">
                                {loading ? 'กำลังโหลด...' : 'เข้าสู่ระบบ'}
                            </button>
                        </form>
                        <div className="mt-6 pt-6 border-t text-center text-xs text-slate-400">copy right by yingyot</div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
